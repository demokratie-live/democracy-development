kind: Build
name: import-conference-week-details
description: Import conference week details for the bundestag.io API
type: container
source:
  path: ../../../
include:
  - ./**/*
  - ./infra/Dockerfile
spec:
  dockerfile: ./infra/Dockerfile
  buildArgs:
    NODE_VERSION: 18.18.2
    SERVICE: import-conference-week-details
    SERVICE_PATH: services/cron-jobs/import-conference-week-details
  extraFlags: ['--load']

---
kind: Run
name: import-conference-week-details
description: Ad-hoc import-Job for Conference Week Details
dependencies:
  - build.import-conference-week-details
  - deploy.mongo

varfiles:
  - path: .env
    optional: true
  - path: .env.local
    optional: true

variables:
  DB_URL: mongodb://democracy-mongo:27017/bundestagio

type: kubernetes-pod
spec:
  podSpec:
    restartPolicy: Never
    containers:
      - name: import-conference-week-details
        image: ${actions.build.import-conference-week-details.outputs.deploymentImageId}
        imagePullPolicy: IfNotPresent
        env:
          - name: DB_URL
            value: ${var.DB_URL}
          - name: DEBUG
            value: '${var.DEBUG || "false"}'
