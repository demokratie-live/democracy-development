kind: Build
name: import-plenary-minutes
description: Import procedures for the bundestag.io API
type: container
source:
  path: ../../../
include:
  - ./**/*
  - ./infra/Dockerfile
spec:
  dockerfile: ./infra/Dockerfile
  buildArgs:
    NODE_VERSION: 18.18.2
    SERVICE: import-plenary-minutes
    SERVICE_PATH: services/cron-jobs/import-plenary-minutes
  extraFlags: ['--load']

---
kind: Deploy
name: import-plenary-minutes-config
type: kubernetes

variables:
  DB_URL: mongodb://democracy-mongo:27017/bundestagio

source:
  path: manifests

spec:
  manifestTemplates:
    - ConfigMap.yaml

---
kind: Run
name: import-plenary-minutes
description: Ad-hoc Import-Job f√ºr Plenarprotokolle
dependencies:
  - build.import-plenary-minutes
  - deploy.mongo
  - deploy.import-plenary-minutes-config

type: kubernetes-pod

spec:
  podSpec:
    restartPolicy: Never
    containers:
      - name: import-plenary-minutes
        image: ${actions.build.import-plenary-minutes.outputs.deploymentImageId}
        imagePullPolicy: IfNotPresent
        envFrom:
          - configMapRef:
              name: import-plenary-minutes
